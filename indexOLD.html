<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode AI Interviewer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* A little extra style for a better font */
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
    </style>
</head>
<body class="bg-gray-900">

    <div id="root"></div>

    <script type="text/babel">
        // The exact same React code you've been working with.
        
        const { useState, useRef, useEffect } = React;

        // Helper component for icons
        const Icon = ({ path, className = "w-6 h-6" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}>
                <path d={path} />
            </svg>
        );

        const UserIcon = () => <Icon path="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />;
        const BotIcon = () => <Icon path="M15 9H9V7h6v2zm-2 4H9v-2h4v2zm8-2V9h-2V7h-2V5h-2v2h-2v2h2v2H9v2H7v2h2v2h2v-2h2v-2h2v-2h2v2h2v-2zm-4-4V5h-2v2h2zM5 5h2v2H5V5zm-2 12v-2h2v2H3zm2 2v-2h2v2H5z" />;

        // Main App Component
        function App() {
            const [problem, setProblem] = useState('');
            const [code, setCode] = useState('');
            const [interviewStarted, setInterviewStarted] = useState(false);
            const [messages, setMessages] = useState([]);
            const [userInput, setUserInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            const chatEndRef = useRef(null);

            // Automatically scroll to the bottom of the chat
            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            // **GEMINI API CALL FUNCTION**
            const callGeminiAPI = async (chatHistory) => {
                // !!! IMPORTANT !!!
                // 1. Get your API key from https://aistudio.google.com/app/apikey
                // 2. Paste it here, replacing "AIzaSyAhYyaZnZK9MriZDvWGYkxrOhEQdaKSpAc"
                const apiKey = "AIzaSyDdH74RTvMVTxRXpuvh9q-jKm1tXPnwo0A"; 
                
                if (apiKey !== "AIzaSyDdH74RTvMVTxRXpuvh9q-jKm1tXPnwo0A") {
                    setError("Please add your API Key to the code.");
                    throw new Error("API Key not set.");
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const payload = {
                    contents: chatHistory,
                    safetySettings: [
                        { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                    ],
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`API call failed with status: ${response.status}. Body: ${errorBody}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                  return result.candidates[0].content.parts[0].text;
                } else {
                  console.error("Unexpected API response structure or content blocked:", result);
                  setError("The response was blocked or empty. Please try rephrasing your message.");
                  return "I'm sorry, I couldn't process that. Let's try a different question. Can you explain your choice of data structures?";
                }
            };

            const handleStartInterview = async () => {
                if (!problem.trim() || !code.trim()) {
                    setError('Please provide both the problem description and your code.');
                    return;
                }
                
                setError(null);
                setInterviewStarted(true);
                setIsLoading(true);

                // --- NEW, IMPROVED PROMPT ---
                const initialPrompt = `You are a demanding but fair senior engineer at a top tech company. Your goal is to conduct a rigorous technical interview and find the limits of the user's knowledge.

                RULES:
                1.  Engage in a dialogue. Do NOT lecture.
                2.  Ask only ONE open-ended question at a time.
                3.  NEVER summarize the user's answer and say "Thanks" or "Good." Instead, ask a follow-up question.
                4.  Your response MUST ALWAYS end with a single, specific, probing question.

                Here is the problem and the user's solution:
                PROBLEM: """${problem}"""
                SOLUTION: """${code}"""

                INTERVIEW FLOW:
                1.  Start by asking the user for a high-level explanation of their approach.
                2.  After their explanation, your NEXT question MUST be about the Time and Space Complexity of their solution.
                3.  Then, probe them on potential edge cases they might have missed.
                4.  Finally, ask them about alternative solutions and the trade-offs involved.

                Begin the interview now.`;
                
                const initialHistory = [{ role: 'user', parts: [{ text: initialPrompt }] }];
                
                try {
                    const response = await callGeminiAPI(initialHistory);
                    setMessages([{ role: 'model', text: response }]);
                } catch (error) {
                    console.error("Error starting interview:", error);
                    if (!error.message.includes("API Key not set")) {
                       setError(`Error starting interview: ${error.message}`);
                    }
                    setMessages([]);
                    setInterviewStarted(false);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleSendMessage = async (e) => {
                e.preventDefault();
                if (!userInput.trim() || isLoading) return;

                const newUserMessage = { role: 'user', text: userInput };
                const historyForApi = [...messages.map(msg => ({
                    role: msg.role === 'model' ? 'model' : 'user',
                    parts: [{ text: msg.text }]
                })), { role: 'user', parts: [{ text: userInput }] }];

                setMessages(prev => [...prev, newUserMessage]);
                setUserInput('');
                setIsLoading(true);
                setError(null);

                try {
                    const response = await callGeminiAPI(historyForApi);
                    setMessages(prev => [...prev, { role: 'model', text: response }]);
                } catch (error) {
                    console.error("Error sending message:", error);
                    setError(`Error fetching response: ${error.message}`);
                    setMessages(prev => [...prev, { role: 'model', text: 'My apologies, I encountered an error. Please try again.' }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="flex h-screen bg-gray-900 text-white font-sans">
                    {/* Left Panel */}
                    <div className="w-1/2 p-6 flex flex-col space-y-4 overflow-y-auto">
                        <h1 className="text-3xl font-bold text-cyan-400">LeetCode AI Interviewer</h1>
                        <p className="text-gray-400">Paste your problem and code below, then start the interview.</p>
                        
                        <div>
                            <label htmlFor="problem" className="block text-sm font-medium text-gray-300 mb-2">Problem Description</label>
                            <textarea
                                id="problem"
                                rows="10"
                                className="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:outline-none transition"
                                placeholder="e.g., Given an array of integers nums and an integer target, return indices of the two numbers such that they add up to target."
                                value={problem}
                                onChange={(e) => setProblem(e.target.value)}
                                disabled={interviewStarted}
                            />
                        </div>
                        
                        <div>
                            <label htmlFor="code" className="block text-sm font-medium text-gray-300 mb-2">Your Code Solution</label>
                            <textarea
                                id="code"
                                rows="15"
                                className="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg font-mono text-sm focus:ring-2 focus:ring-cyan-500 focus:outline-none transition"
                                placeholder="e.g., function twoSum(nums, target) { ... }"
                                value={code}
                                onChange={(e) => setCode(e.target.value)}
                                disabled={interviewStarted}
                            />
                        </div>

                        {!interviewStarted && (
                            <button
                                onClick={handleStartInterview}
                                className="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Start Interview
                            </button>
                        )}
                        {error && <div className="bg-red-800 border border-red-600 text-white px-4 py-3 rounded-lg relative" role="alert">
                            <strong className="font-bold">Error: </strong>
                            <span className="block sm:inline">{error}</span>
                        </div>}
                    </div>

                    {/* Right Panel */}
                    <div className="w-1/2 p-6 flex flex-col bg-gray-800 border-l border-gray-700">
                        <h2 className="text-2xl font-bold text-gray-200 mb-4">Technical Interview</h2>
                        <div className="flex-1 overflow-y-auto pr-2 space-y-6">
                            {!interviewStarted ? (
                                <div className="flex items-center justify-center h-full">
                                    <p className="text-gray-500">The interview will appear here.</p>
                                </div>
                            ) : (
                                messages.map((msg, index) => (
                                    <div key={index} className={`flex items-start gap-3 ${msg.role === 'user' ? 'justify-end' : ''}`}>
                                        {msg.role === 'model' && <div className="flex-shrink-0 w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center"><BotIcon /></div>}
                                        <div className={`p-3 rounded-lg max-w-lg ${msg.role === 'model' ? 'bg-gray-700' : 'bg-cyan-800'}`}>
                                            <p className="text-sm whitespace-pre-wrap">{msg.text}</p>
                                        </div>
                                        {msg.role === 'user' && <div className="flex-shrink-0 w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center"><UserIcon /></div>}
                                    </div>
                                ))
                            )}
                            {isLoading && (
                                 <div className="flex items-start gap-3">
                                    <div className="flex-shrink-0 w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center"><BotIcon /></div>
                                    <div className="p-3 rounded-lg bg-gray-700">
                                        <div className="flex items-center space-x-1">
                                            <span className="w-2 h-2 bg-cyan-400 rounded-full animate-pulse delay-0"></span>
                                            <span className="w-2 h-2 bg-cyan-400 rounded-full animate-pulse delay-150"></span>
                                            <span className="w-2 h-2 bg-cyan-400 rounded-full animate-pulse delay-300"></span>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div ref={chatEndRef} />
                        </div>
                        <form onSubmit={handleSendMessage} className={`mt-4 flex items-center space-x-2 ${!interviewStarted ? 'hidden' : ''}`}>
                            <input
                                type="text"
                                value={userInput}
                                onChange={(e) => setUserInput(e.target.value)}
                                className="flex-1 p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:outline-none transition"
                                placeholder="Your answer..."
                                disabled={isLoading}
                            />
                            <button type="submit" className="bg-cyan-600 hover:bg-cyan-700 p-3 rounded-lg disabled:bg-gray-600 disabled:cursor-not-allowed" disabled={isLoading}>
                                <Icon path="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>

</body>
</html>
